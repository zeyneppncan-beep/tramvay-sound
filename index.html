<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IND338 Sound of Journey</title>
<script src="https://static.sketchfab.com/api/sketchfab-viewer-1.12.1.js"></script>

<style>
    /* GENEL AYARLAR */
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; }
    
    /* 3D MODEL ALANI */
    #viewer { width: 100%; height: 100%; border: none; position: absolute; top: 0; left: 0; z-index: 1; }

    /* GİRİŞ EKRANI */
    #intro-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: #111;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        z-index: 99999;
        color: white;
        text-align: center;
        transition: opacity 0.8s ease;
    }

    h1 { font-size: 3rem; margin: 0 0 10px 0; letter-spacing: 2px; font-weight: 300; text-transform: uppercase; }
    h2 { font-size: 1.5rem; margin: 0 0 10px 0; color: #eee; font-weight: 500; letter-spacing: 1px; }
    h3 { font-size: 1rem; margin: 0 0 40px 0; color: #e91e63; font-weight: 400; letter-spacing: 1px; }

    /* PEMBE HEAR BUTONU */
    #btnHear {
        padding: 15px 60px; font-size: 24px; font-weight: bold;
        background-color: #e91e63; color: white; border: none;
        border-radius: 50px; cursor: pointer;
        box-shadow: 0 0 20px rgba(233, 30, 99, 0.4);
        transition: all 0.3s ease; letter-spacing: 1px;
    }
    #btnHear:hover { 
        background-color: #ff4081; transform: scale(1.05); 
        box-shadow: 0 0 30px rgba(255, 64, 129, 0.6); 
    }

    #status { margin-top: 20px; font-size: 12px; color: #777; }
</style>
</head>
<body>

<div id="intro-screen">
    <h1>IND338 Sound of Journey</h1>
    <h2>Işıl Can</h2>
    <h3>Contact: isillccan@gmail.com</h3>
    <button id="btnHear">HEAR</button>
    <div id="status">Click HEAR to start journey</div>
</div>

<iframe src="" id="viewer" allow="autoplay; fullscreen; vr" allowvr allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

<script>
    var screen = document.getElementById("intro-screen");
    var btn = document.getElementById("btnHear");
    var statusDiv = document.getElementById("status");
    var audioUnlocked = false;
    var sounds = [];

    // === SES LİSTESİ ===
    var fileList = [
        "sounds/trafik.mp3",       // No 1
        "sounds/tramvay_ic.mp3",   // No 2
        "sounds/tramvay_ray.mp3",  // No 3
        "sounds/kapi.mp3",         // No 4
        "sounds/marti.mp3",        // No 5
        "sounds/nefes.mp3",        // No 6
        "sounds/eyupsultan.mp3",   // No 7
        "sounds/silahtaraga.mp3",  // No 8
        "sounds/esneme.mp3",       // No 9
        "sounds/sahil.mp3"         // No 10
    ];

    // Sesleri yükle (Hata olsa bile devam et)
    fileList.forEach(function(src) {
        var aud = new Audio(src);
        aud.loop = true;
        sounds.push(aud);
    });

    // === GARANTİLİ BAŞLATMA (FORCE START) ===
    btn.onclick = function() {
        statusDiv.innerText = "Entering...";
        
        // Ses sistemini tetikle
        if(sounds[0]) {
            sounds[0].play().then(function() {
                sounds[0].pause();
                sounds[0].currentTime = 0;
                audioUnlocked = true;
            }).catch(function(err) {
                console.log("Ses ön yükleme hatası (Önemli değil): " + err);
            }).finally(function() {
                // NE OLURSA OLSUN EKRANI KAPAT
                girisEkraniniKapat();
            });
        } else {
            // Ses yoksa bile ekranı kapat
            girisEkraniniKapat();
        }
    };

    function girisEkraniniKapat() {
        screen.style.opacity = "0";
        setTimeout(function(){ 
            screen.style.display = "none"; 
        }, 800);
    }

    // === SKETCHFAB ===
    var iframe = document.getElementById( 'viewer' );
    var uid = '35d9707a712d4da1a88d1e4f82da8797';
    var client = new Sketchfab( iframe );

    client.init( uid, {
        success: function( api ) {
            api.start();
            api.addEventListener( 'viewerready', function() {
                console.log('Model hazır.');
                
                api.addEventListener( 'annotationFocus', function( index ) {
                    // Eğer kullanıcı butona basmadan bir şekilde girdiyse ses çalma
                    // Ama artık butona basmak zorunlu olduğu için sorun yok.
                    
                    // Öncekileri sustur
                    sounds.forEach(function(s){ s.pause(); s.currentTime=0; });

                    // Yeniyi çal
                    if(sounds[index]) {
                        sounds[index].play().catch(e => console.log("Oynatma hatası:", e));
                    }
                });
            } );
        },
        error: function() { 
            console.log('Sketchfab yüklenemedi.');
        },
        autostart: 1, ui_controls: 1, ui_annotations: 1
    } );
</script>
</body>
</html>
